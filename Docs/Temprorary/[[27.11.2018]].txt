[20:49 27.11.2018]

Похоже, получилось настроить настройки UnSecure и Secure для того, чтобы получить менее защищённую систему, но открытую "из вне" для подключения с использованием пароля, и более защищённая система, в которой отключён удалённый доступ и шара для всех дисков. Осталось ещё найти, как задать ключ реестра, разрешающий доступ к шаре для анонимных пользователей (в обход групповых политик). Но и без этого проделана большая работа по разрешению или запрещению шары.

Пугаться того, что "шара стала общедоступной", по большому счёту, не стоит. Настройки доступа NTFS, данная программа не меняет, а значит, если для файлов закрыт доступ идля пользователя "Все" ("Everyone"), а открыт только для администраторов, то только администраторы получат доступ к шаре. А если данные файлы располагаются в шифрованной файловой системе, тогда вообще просмотр их всеми пользователями, не имеющими данный сертификат и прежние атрибуты, будет невозможен. Вообще "доступ для всех" говорит лишь о том, что "все могут открыть шару", но не прочитать её. К тому же, если в настройках общего доступа указано "разрешить доступ с парольной защитой", то только пользователи, имеющие пароль на данной машине, могут зайти в шару, не смотря на то, что она "открыта для всех". Так что эта опция может оказаться полезной не только для взломщиков и хакеров...

Теперь что касается второго вопроса, с определением прав доступа для домена в команде net localgroup. В справке по этой команде я прочитал следующее:

1. Опция /DOMAIN -- выполняет операциюна контроллере домена в текущем домене.

Это значит, что все операции, произведённые с указанием этой опции, будут осуществляться не на локальном компьютере, а на первичном контроллере домена. При этом префикс домена указываться НЕ БУДЕТ! Для хакера это очень хорошо, ведь имя домена изначально ему не известно. Однако, чтобы назначить администраторов домена локальными администраторами компьютера, то см. п. 2.

2. имя -- в описании параметра "имя" есть фраза. "Эти имена могут быть именами пользователей илди именами глобальных групп, но не именами других локальных групп. Если указывается пользователь из другого домена, его имени должно предшествовать имя домена (DOMAIN\LOGIN)". Для хакеров это значит:

* Глобальной группе нельзя поставить в соответствие локальную группу, наоборот можно. Это значит, что создав на компьютере локальную группу пользователей, Вы не можете ей сопоставить дочернюю локальную группу иначе, как не в графическом интерфейсе. Поэтому пользовательские локальные группы имеют для хакера только чисто теоретический интерес.
* Если нужно присвоить администраторам домена права локальных администраторов на компьютере, еэто можно попытаться сделать только при помощи следующих команд:

net localgroup Администраторы %UserDomain%\"Администраторы домена" /add

net localgroup  "Администраторы домена" %COMPUTERNAME%\"Администраторы" /DOMAIN

Причём обе эти команды не будут работать, если компьютер не подключён или не авторизован в домене. А какой из синтаксисов будет работать, и будет ли работать вообще, может решить только практика.

Следующий вопрос касается определения окружения компьютера для более точной хакерской атаки на сервер Windows. Как мы уже знаем, данные о домене и пользователях сервера изначально не известны хакеру. Только получив доступ к любому компьютеру в домене от имени пользователя домена, хакер может получить эту информацию. Для этого просто нужно подать команды:

systeminfo > system_information.txt
set >> system_information.txt
wmic.exe ComputerSystem get Name, PartOfDomain, Domain, Workgroup, DNSHostName, DomainRole >> system_information.txt

Первой командой хакер получает базовую информацию о компьютере -- его имя, производитель, версия операционной системы, установленные обновления, сетьевую информацию. Данные перезаписываются в файл system_information.txt Вторая команда дописывает в этот же файл все переменные окружения для этого компьютера и данной учётной записи. И, наконец, третья команда определяет, подключён ли компьютер к домену, роль компьютера в домене, имя домена и рабочей группы, имя компьютера и DNS имя компьютера. Полученной информации будет достаточно, чтобы осуществить осознанную атаку на Windows Server.

Конечно же, дополнительно могут потребоваться внешний IP адрес компьютера, его внутренний адрес на маршрутизаторе и логин/пароль пользователя, для которого будет выполняться скрипт. Но по-умолчанию предполагается, что Вы эти данные уже получили, иначе вы бы не смогли запустить скрипт. :-) Логин/Пароль можно узнать брутфорсом, атакой по словарю или воспользовавшись одной из общих уязвимостей операционных систем. IP адрес компьютера можно найти, сканируя сеть провайдера или методом социальной инженерии. Внутренний адрес компьютера на маршрутизаторе узнать сложнее всего. Надо или взломать маршрутизатор, либо запустить указанный скрипт средствами социальной инженерии и обеспечить его доставку на сервер "хозяина".

[12:50 28.11.2018]

Ещё одно замечание по поводу файлов стайлера. Последние мои изыскания приблизили его к тому, чтобы сделать все его файлы максимально универсальными. В результате автор разделил основные файлы Exponenta (манипуляции с реестром и установка программ) в универсальный инсталлятор, а файлы загрузки и файлы отправки данных на сервер надо будет выделить в отдельный инсталлятор.

Следующая мысль только для мозгового штурма. Может быть, файлы персонализированного инсталлятора сохранять на сайте Hacker_host2? например, в каталоге MainFiles? В этом случае сайт Hacker_host1 может стать универсальным, и представлять собой "хребет архитектуры" инфраструктуры стайлера, к которому возможно обращение всех пользователей стайлера, причём совершенно бесплатно. И наполнять этот инфраструктурный репозиторий только "относительно безобидными" скриптами, не делающие никаких вредоносных и шпионских действий. Вообще позиционировать такой сайт как сайт по обмену административных скриптов? Над этим нодо подумать...

Третья мысль. А не сделать ли похожий инсталлятор для каталога Util, в котором я храню различные собственные утилиты для работы моего компьютера? Тоже сделать из него инсталляционный файл с установкой переменной окружения UTIL? Правда, мне придётся произвести ревизию этой папки, избавив её от консольных программ под MS-DOS, которые 100% не будут работать в новой Windows. Надо бы этим заняться...
