
[[18.05.2018]]

[16:51:49]

В основном отладил скрипт инсталляции-деинсталляци пакета на примере плагина к моему ботнету -- программного пакета Elevation с дополнениями. Поскольку этот пакет является административным, я предусмотрел "скрытую" установку и "открытое" удаление дистрибутива этого пакета. Для чего скрыто устанавливать, думаю, всем понятно. А вот открытое удаление лежит в области психологии. Единожды установленный, этот пакет интегрируется в систему и воспринимается любым системным администратором как "что-то очень нужное". Поскольку оно лежит открыто на жёстком дмиске, в паке, для которой она и была создана, у администратора может сложиться де жа вю, что "что-то подобное я устанавливал". Ему и мысмль не придёт, что запускаемыйв командной строке по требованияю файл cmd.exe может служить компонентом вируса. Да-да.

Теперь для тех кто не в теме, что это за пакет Elevation. Elevation -- это командное окружение, ядро которого написано на Visual Basics Script а модули -- в виде командных файлов, которые позволяют запускать программы с повышенными привилегиями из-под учётной записи пользователя компьютера. По идее эти программы не могут запускать вирусы, поскольку требуется дополнительное подтверждение UAC на выполнение операций на компьютере. Но это т олько по идее -- предупреждения UAC можно скрывать при помощи других таких же системных программ. Основное же назначение этих пакетов -- не давать никому на компьютере работать под учётной записью администратора, так как это небезопасно. Автор широрко пользуется этим пакетом. Например, с его помощью можно запустить консоль cmd или  Powershell из-под работающего cygwin, putty или вообще из подсистемы Linux. Надо т олько знать команды, и автор дополнил этот пакет дополнительным списком для обеспечения административного доступа. По понятным причинам, в публичную версию пакета не вошли файлы, содержащие пароли и список запущенных на компьютере автора служб. Но это и не нужно -- под себя такие скрипты может написать любой грамотный системный администратор.

К сожалению, у данного инсталлятора осталась одна "ахилесова пята", которая не позволяет его называть "совершенно скрытым". Да, инсталляция пакетов проходит в "шепчушем режиме", не выводится ни одно сообщение, а о работе приложения можно судить только по запущенном в диспетчере процессов скрытых командных файлов и оболочки "cmd.exe". Система автоматическиреагирует на возможные проблемы с установкой, и даже при неполной установки операционная система остаётся полностью работоспособной, а сами пакеты -- частично работоспособными. Правда, логи установки автор пока ещё сделать не додумался. :-) Но инсталлятор при установке запрашивает контроль учётных записей, а на значке приложения в Windows 10 видна пометка "запускать с правами администратора". И это "с головой выдаёт" этот файл именно как исполняемый, даже если ему поменять расширение. К счастью, ни один из антивирусов не опознаёт этот пакет как зараженный (что было бы странно с их стороны, учитывая полную безопасность программ двойного назначения, входящих в пакет). 

Для сборки инсталлятора дистрибутива автору потребовались дополнительно следующие пакеты:

* Менджер пакетов Windows Chocolatey. С его помощью можно незаметно, из командной строки, даже удалённо, устанавливать различные пакеты для Microsoft Windows и зависимости для него. Устанавливается из командной строки PowerShell 2.0, а значит для его работы нужна Windows 7 SP1 не ниже. Как установить менеджер пакетов, можно почитать на сайте https://chocolatey.org. Там же на сайте выложена база данных с присутствующими в системе пакетами.

* Упаковщик 7z, позволяющий делать архивы минимального веса, к тому же и бесплатно. Он устанавливается из менеджера пакета chocolatey командой:

choco install -y 7zip.install 7zip

* Программа Bat-to-exe Converter/ Эта команда конвертирует командные файлы Windows с расширением BAT в полноценные файлы Microsoft Windows. Среди её полезных функций автор отмечает следующее:

* Не смотря на то, что эта программа является по сути джойнером, она не определяется как вирус;
* Программа позволяет, помимо основного файла, включать в себя любые дополнительные файлы для запуска. При этом можно указать, куда программа будет распаковывать дополнительные файлы и что с ними делать после завершения.
* Программа пгозволяет запускать файл как в консольном, так и скрытом, "шепчущем" режиме.
* Программа позволяет назначить файлу любой значок;
* Программу можно настроить на запуск установки индивидуально для систем разной битности, что может помочь проводить эффективную специфичную инсталляцию под нужное железо, с невозможностью запуска программы на других платформахж.

Установить программу можно с помощью менеджера пакета chocolatey комендой:

choco install battoexeconverter

* Альтернативный менеджер  SFX архивов для 7Zip. Недостатком стандартного 7zip SFX модуля является невозможность в нём проводить скрытое разархивирование, без показа полосы прогресса. Из-за этого такие архивы не подходят для скрытой установки. Проблему решает альтернативный менеджер SFX, официальный сайт которого закрыт, а пакет можно скачать с саайта https://rsload.net/soft/cleaner-disk/11772-7z-sfx-builder.html или по прямой ссылке с сайта, требующей авторизации с сайта rsload.net: http://95.141.193.17/noload2/files/049/rsload.net.7z.SFX.Builder.2.1.zip/ Также автор обязуется выложить ссылку на файл на своём FTP сервере. НЕ смотря на сложности скачивания, файл не содержит пароля, а содержит в себе инсталлятор модуля, который при этом "не лезет" в паку с оригинальным 7z. 

Преобразование файла в формат EXE здесь занимает больше телодвижений, чам в родном инсталляторе (который, кстати, не затирается). Но со всем можно разобраться при помощи встроенной справки, которая в программе весьма толковая. Саама графическая оболочка поможет подготовить файл конфигурации для генерирования SFX архивов "индивидуально под Ваши условия на все времена". Вам придётся написать небольшой командный файл для автоматизации генерации самораспаковывающегося архива, поместить этот командный файл, файл конфигурации, выбранный из богатого списка нужный SFX модуль (копируется из каталога с установленной программой), собственно 7z файл, собранный в любой программе, но со специально подобранными параметрами архивирования под выбранный модуль, и запустить командный файл. Через 5 секунд в Вашем каталоге появится файл уже с расширением EXE, который Вы можете использовать по своему усмотрению.

Возможностей альтернативного установщика 7zip SFX деже больше, чем в программе Bat-to-Exe Converter, однако он не является джойнером и с его помощью нельзя сделать по-настоящему незаметные действия. Кроме того, если назначить такому архиву запуск под учётной записью администратора, у него будут большие проблемы с незаметностью установки (замучаетесь подтверждать UAC, или у Вас ничего не заработает). Поэтому автор рекомендует осуществлять скрытую установку из этого архива только внутри контейнера Bat-to-Exe, запущенного с правами администратора. При этом разрешить архиву распаковываться под учётной записью обычного пользователя, даже если по логике вещей это невозможно.

Итак, с помощью этих программ автор создал автоматический инсталлятор пакета Elevation и проверил его работоспособность на гостевой виртуальной машине. За исключением мелких недочётов, всё работает. На всякий случай автор удалил неотлаженые и рабочие версии инсталлятора с сайта, оставив только дистрибутивы.

[18:25:05]

Я наконец-то определился с планами по развитию разработки своего "зловреда". В системе будет только один базовый инсталлятор, который является пользователе-чувстсвительным и должен настраиваться индивидуально, один раз при заражении, и система "плагинов", которые расширяют базовую функциональность взломщика. В отличие от общей системы, деинсталляция плагинов не предусмотрена (возможно только их отключение), и удаляются они только вместе со всем приложением - "зловредом" через скрытый деинсталлятор. Установка базовой части пакета будет осуществляться только при активном соединении с Интернетом, тогда как деинсталляция пакета возможна в режими офлайн и даже удалённо. Кроме того, отдельные плагины можно деинсталлировать "ручками", поскольку документация по плагинам открытая.

Базовый пакет инсталлируется при помощи одного инсталляционного файла, к которому при желании можно подключить загрузку дополнительных плагинов из списка доступных (в виде внедряемых инсталляторов с запуском из основного инсталлятора). Этот инсталляционный файл осуществляет следующие действия.

После инсталляции файлов пакета в системном окружении операционной системы появляются следующие переменные:

* Hacker_User – имя (логин) учётной записи компьютера-жертвы на ftp серверах хозяина, с которых будет осуществляться управление ботнетом
* Hacker_Pass – пароль для этой учётной записи. Его нужно указывать, чтобы посторонние не имели доступа к данным жертвы на сервере хозяина. Внимание! Пароль храниться в незащищённом виде! Просто автор не нашёл способа безопасного использования хеша и солей в программах коммуникации.
* Hacker_host1 – доменное имя публичного хоста, с которого скачивается установочные файлы и публичные обновления ботнета. Её значение может совпадать со значением следующей переменной, когда используется только один хост.
* Hacker_host2 – доменное имя приватного хоста, с которого скачиваются в оффлайн-режиме команды управления ботнетом и на который передаются результаты его работы
* Hemail_User -- логин от аккаунта Gmailдля взлома (без обязательной части @gmail.com. Используется в модулях, которые передают сообщения по электронной почты
* Hemail_Pass -- пароль от аккаунта Gmail
Примечание. Пароли записываются в незашифрованном виде. Будьте осторожны!
* Скрытый каталог C:\pub1, в котором размещаются файлы пакета и доступ к которому возможен только для администратороа. К этому каталогу впоследствии может быть организован удалённый доступ. В этом каталоге обязательно должна содержаться папка Util  для запуска эксплоитов и административных задач. Остальные папки создаются по мере надобности
* Учётная запись MSSQLSR Microsoft Windows с паролем "Admin01234" и административными привилегиями, которая тут же блокируется. Эта запись потом потребуентся с целью организации удалённого достуапа к компьютеру.
* Файл для деинсталляции Exponenta вместе с модулями
* Файл для продажи Exponente другому лицу
* Файл для автоматического выполнения командных файлов при загрузке компьютера (основная часть ботнета Exponenta) onsysload.bat

Список подготовленных плагинов автор приводит здесь:

Elevation. Must Have для всех последующих пакетов программ, которые должны организовывать запуск программ с правами администратора. Местоположение пакета: C:\Elevation.

Hidden Start. Устанавливается дополнительно к пакету Elevation для сокрытия производимых им действий. Местоположение пакета "C:\Program Files\Hidden Start"

Собственно троян-эксплоит Exponenta. С помощью этого модуля можно получать Недостающие пакеты для удалённого управления минуя социальный инжениринг. Местиоположение пакета C:\pub1\Util

Модуль для Exponenta для сбора информации о компьютере и передачи её на FTP сервер хозяина.

Модуль для Exponenta для передачи внешнего IP адреса компьютера в момент включения на FTP сервер хозяина

Модуль для Exponenta для открытия доступа к компьютеру по telnet протоколу (Инсталляция встроенного telnet-сервера). Одновременно эксплоит активирует запись для доступа. Не работает в Windows 10.

Модуль Exponenta для активации доступа к компьютеру по протоколу WinRM. Универсальное решение, но сложное в реализации.

Модуль Exponenta для переименования учётной записи локального администратора и смены в ней пароля. Это необходимо для первоначального доступа к компьютеру программой DameWare

Модуль Exponenta для DynDNS сервера разрабатывается индивидуально.

Модуль Exponenta для встраивание в планировщик задач. Пока не написан.

Модуль Exponenta для установки произвольных пакетов и плагинов

Модуль Exponenta для учёта времени включения компьютера

Примечание. Модули Exponenta могут обновляться через профиль пользователя на FTP сервере.

Chocolatey/ Менеджер пакетов Must Have Windows. Инсталлируется в папку C:\ProgramData\chocolatey/ Служит для оперативного скачивания зависимостей пакета.

sTunnel. Программа для туннелирования доступа компьютера-жертвы к различным серверам. Устанавливается через Chocolatey. Особо необходима для работы следующего пакета.
Также вариант -- проброс портов через прокси-сервер (пока только идея).

blat. Программа отправки почты по протоколу SMTPв Интернет. Служит для скрытой отправки сообщений с компьютера через почтовый ящик Google Полезна, когда FTPсервер не работает

[19:35:57].

Полезные советы.

1. Инсталлируйте толко те модули, в которых Вы нуждаетесью Вариант забит пакет модулями под завязку "на всякий случай" -- плохая идея с точки зрения безопасности и анонимности.

2. Чтобы не скомпрометировать учётные записи, периодичесмки меняйте логины и пароли программы с помощью модуля "продажи ботнета".

3. Как только Вы получили устойчивый удалённый доступ к компьютеру-жертве, немедленно деактивируйте неактуальные модули, а может быть, весь ботнет Exponenta. А то как бы чего не вышло. 


