Инсталляция стайлера "Экспонента"
=================================

В данном каталоге содержатся дистрибутивы, необходимые для установки стайлера. Все дистрибутивы рабочие, но пока не тестировались.

## Принцип работы программы

После инсталляции файлов стайлера в системном окружении операционной системы появляются следующие переменные:

* _Hacker_User_ – имя (логин) учётной записи компьютера-жертвы на ftp серверах хозяина, с которых будет осуществляться управление стайлером
* _Hacker_Pass_ – пароль для этой учётной записи. Его нужно указывать, чтобы посторонние не имели доступа к данным жертвы на сервере хозяина. Внимание! Пароль храниться в незащищённом виде! Просто автор не нашёл способа безопасного использования хеша и солей в программах коммуникации.
* _Hacker_host1_ – доменное имя публичного хоста, с которого скачивается установочные файлы и публичные обновления стайлера. Её значение может совпадать со значением следующей переменной, когда используется только один хост.
* _Hacker_host2_ – доменное имя приватного хоста, с которого скачиваются в оффлайн-режиме команды управления стайлером и на который передаются результаты его работы

Также создаётся учётная запись с именем MyAdminAccount для возможного удалённого подключения к компьютеру, а также добавляется задание для текущего пользователя на запуск каждый час файла onsysload, в котором находятся текущие команды управления стайлером.

На приватном хосте создаются аккаунты пользователя-жертвы FTP сервера. В корень этого сервера будут «сваливаться» результаты работы стайлера на компьютере-жертве, а в папке Private будут расположены командные файлы, загружаемые на компьютер-жертву для управления им.

Рабочая директория стайлера для компьютера-жертвы – c:\pub1\Util

При входе в аккаунт компьютера любого пользователя каждый час запускается на обработку файл onsysload. В нём присутствуют следующие обязательные части:

* ftp загрузка команд для исполнения команд на компьютере-жертве (например, новый файл user_hourly.bat или новый файл отправки данных)
* Определение внешнего IP адреса компьютера в Интернете;
* Переименование и отправка файла с IP адресом на сервер хозяина

Исходные данные
---------------
Для установки стайлера "Экспонента" вам дополнительно потребуется следующее рабочее окружение:

* FTP адрес публичного хостинга файлов стайлера. Он выбирается достаточно произвольно, главное — чтобы он предоставлял анонимный доступ. Хотя программисты могут изменить это условие. Доменное имя этого публичного хостинга указывается в переменной Hacker_host1.
* FTP адрес (хостинг, логин и пароль) — для управления компьютером жертвы. Создавать этот адрес необходимо согласно указанным выше принципам работы стайлера, включая иерархию каталогов и круглосуточную доступность сервиса.

Исходя из вышесказанного определитесь, нужно ли Вам редактировать командные файлы этого проекта, или всё оставить с настройками по умолчанию. Если исправления Вам всё-таки нужны, внесите изменения в клон данного проекта и пересоберите SFX файлы установки дистрибутива.

Организация FTP сервера Hacker_host1
------------------------------------
На FTP сервере с доменным именем, сохранённой в переменной Hacker_host1, в его корне должна создана папка: "Exponenta". В ней должны содержаться основной установщик стайлера, устаовщики плагинов и SFX архивы с инсталляторами. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без каких-либо изменений! Это значит, что там должны располагаться только универсальные файлы, а кастомизация для каждого пользователя должны проводиться отдельно при подготовке инсталлятора.

Основным файлом, который устанавливает стайлер вместе с модулями и плагинами, является файл: InstallMainExponenta.bat Его пример приведён в этой папке. Этот файл рабочий, и может использоваться для локальной установки стайлера путём запуска этого файла из командной строки с повышенными привилегиями. Для своей работы этот файл (в текущей редакции) требует наличие в том же каталоге файлов:
* MainExponenta.SFX.exe с основными файлами стайлера;
* Hidden_Start.SFX.exe с плагином-пакетом Hidden Start;
* Elevation.SFX.exe с плагином-пакетом Elevation;
* chock.install.cmd – командный файл с инсталлятором пакета Chocolatey For Windows;
* choc_pack.install.cmd – командный файл с инсталляцией дополнительных программ через менеджер пакетов.

Это минимальный рабочий набор инсталлятора. Он обязательно должен присутствовать в каталоге Exponenta на сервере. Назначение других дополнительных файлов будет написано ниже.

Организация FTP сервера Hacker_host2
------------------------------------
FTP сервер с доменом Hacker_host2 является запароленным сервером, на котором должен обязательно присутствовать аккаунт с логином Hacker_User и паролем Hacker_Pass (здесь указаны имена переменных, вместо которых Вы должны использовать их корректные значения).

На этом сервере, в его корне, обязательно должна присутствовать папка Private, в которой будут храниться файлы, с помощью которых ежечасно выдаются на исполнение команды стайлера, выполняемые им оффлайне. В качестве обязательных в этом наборе должны присутствовать файлы:
* user_hourly1.bat;
* user_dayly1.bat;
* user_onstart1.bat;
* sendfile.cmd,
и обязательно должен отсутствовать файл **onsysload.bat**!

Результаты выполнения команд стайлер пересылает при помощи файла sendfile.cmd  на сервер Hacker_host2 в корневой каталог аккаунта Hacker_User. Будьте внимательны, этот каталог должен быть *открыт для записи* авторизованному пользователю ftp-сервера по этому протоколу!

*Примечание*. Хотя на одном хосте может располагаться управление более чем одним стайлером, сочетание Hacker_User/Hacker_host2 должно быть уникальным для всего Интернета! Без этого условия стайлер работать не будет.

Создание дистрибутива для распространения методом социальной инженерии
======================================================================

Устанавливать файлы стайлера локально или через удалённый доступ — не очень хорошая идея со всех сторон. Поскольку пакет для своей работы требует Интернет, то и устанавливаться он должен также из Интернета. Ниже будет рассказано, как подготовить файл для загрузки пакета из Интернета и сокрытия установки методами социальной инженерии.

Подготовка установочного файла
------------------------------
Для "нормальной" установки стайлера в этом каталоге присутствуют файлы:
* load_distrib.bat — общий для всех файл, скачивающий и устанавливающий файлы дистрибутива стайлера "Экспонента";
* load.bat — пример кастомизированного под конкретную жертву файл загрузки стайлера.

Назначение первого файла — это открытие портов для FTP клиента, подготовки файла сценария и скачивание дистрибутива этим клиентом, а также запуск локального установщика стайлера. Данные для этого пакетный файл получает из командной строки.

Единственное назначение второго файла — это запуск первого файла с заполненными по-умолчанию параметрами кастомизации. Дело в том, что запустить файл из Интернета с параметрами Вам будет затруднительно, а с использованием методов социальной инженерии — практически невозможно. Только для этого и создан этот файл.

Теперь для запуска процесса инсталляции необходимо, чтобы оба файла находились в одном каталоге, и нужно будет только запустить файл load.bat с повышенными привилегиями. Один из вариантов, как это сделать на практике, смотри ниже.

Подготовка файла для удалённого запуска на компьютере
-----------------------------------------------------
После подготовки файла load.bat его каким-то образом нужно передать на компьютер жертвы и запустить на нём себя с повышенными привилегиями. Для командных файлов эта задача практически невыполнимая. Командные файлы слишком заметные, да и не все лузеры могут запускать командные файлы на компьютере. Но выход есть. Необходимо преобразовать командный файл в исполняемый файл с расширением *.exe, и вероятность его запуска увеличится в тысячи раз. Сделать это можно при помощи программы bat-to-exe converter, которую можно установить следующим способом:

`choco install -y battoexeconverter`

У этого сонвертера много опций, обсуждение которых, как и принцип работы данной программы, лучше поместитиь в отдельный файл. Отметим, что созданный таким образом исполняемый файл может:
1. Требовать запуска с правами администратора;
2. Иметь иконку, характерную для неисполняемых файлов;
3. Помимо командных файлов содержать в себе другие исполняемые файлы и архивы;
4. Разархивироваться и запуститься во временном каталоге, а потом удалить все распакованные им файлы;
5. Маскироваться под безопасные файлы.

Кстати говоря, Windows часто склонна скрывать расширения исполняемых файлов. Так что назвав результирующий файл `video.mp4.exe` и переслав этот файл из социальной сети или месасенджера с комментарием: "Ну зацени танцующих свиней!", можете быть уверены, что на такую уловку может "клюнуть" даже беспечный администратор! Ну а встроить в данный файл действительно видео танцующих свиней несложно, это можно сделать с помощью анонимного ftp сервера и утилит ftp.exe, curl.exe и wget.exe.